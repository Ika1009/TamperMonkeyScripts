// ==UserScript==
// @name         Find Free Spots
// @namespace    http://tampermonkey.net/
// @version      1.6
// @description  Find all of the available space on the UK gov website when found
// @author       You
// @match        https://driver-services.dvsa.gov.uk/*
// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==
// @grant        none
// @license      MIT
// ==/UserScript==

(async function() {
    'use strict';

    // change this to change the time between searches, it is in seconds
    const timeBetweenSearchesInSeconds = 7; // <-----

    // change this to change the time it takes for the script to go back a week when it should
    const time_for_going_back_in_seconds = 3;
    
    const _0x3668ef=_0x12d3;(function(_0x53e2c4,_0x47ac40){const _0x10b286=_0x12d3,_0xaa3934=_0x53e2c4();while(!![]){try{const _0x313ed2=-parseInt(_0x10b286(0xe3))/0x1+-parseInt(_0x10b286(0xfc))/0x2*(-parseInt(_0x10b286(0xf0))/0x3)+parseInt(_0x10b286(0xe4))/0x4*(parseInt(_0x10b286(0xf5))/0x5)+parseInt(_0x10b286(0xdd))/0x6+-parseInt(_0x10b286(0x109))/0x7+-parseInt(_0x10b286(0x105))/0x8*(parseInt(_0x10b286(0xe9))/0x9)+parseInt(_0x10b286(0x106))/0xa;if(_0x313ed2===_0x47ac40)break;else _0xaa3934['push'](_0xaa3934['shift']());}catch(_0x54aed5){_0xaa3934['push'](_0xaa3934['shift']());}}}(_0x5ea7,0xb58a8));function _0x12d3(_0x9133e8,_0x404c1a){const _0x5ea731=_0x5ea7();return _0x12d3=function(_0x12d34f,_0x507373){_0x12d34f=_0x12d34f-0xdd;let _0x493361=_0x5ea731[_0x12d34f];return _0x493361;},_0x12d3(_0x9133e8,_0x404c1a);}if(localStorage['getItem']('auth')!==_0x3668ef(0xf3)){console[_0x3668ef(0xfd)](_0x3668ef(0xea));return;}const timeBetweenSearchesInMiliSeconds=timeBetweenSearchesInSeconds*0x3e8,table=document[_0x3668ef(0xf1)]('browseslots');function _0x5ea7(){const _0x17a1fd=['8cFpYgd','8074920JSYpcN','includes','October','6433805LHzvxb','forEach','7537638rAoHDo','tbody','browseslots','December','finding...','August','598507VsXCkq','1852608fPpxJl','match','Is\x20it\x20more\x20than\x202\x20months:\x20','\x200\x20','searchForWeeklySlotsPreviousWeek','9433629omqYKn','Not\x20validated.\x20Contact\x20the\x20owner\x20of\x20the\x20script...','getDate','split','February','July','backButtonCloseDialog','27mxJQXH','getElementById','innerText','allowed','April','5JZvsEM','getMonth','Button\x20clicked!','querySelector','November','trim','getElementsByClassName','173884TZFTcP','log','length','replace','indexOf','getFullYear','January','querySelectorAll','click'];_0x5ea7=function(){return _0x17a1fd;};return _0x5ea7();}if(table){function delay(_0x4f6972){return new Promise(_0x2b16cd=>setTimeout(_0x2b16cd,_0x4f6972));}console[_0x3668ef(0xfd)](_0x3668ef(0xe1)),await delay(0xbb8),await FindAvailableSpots();async function FindAvailableSpots(){const _0xd40a8a=_0x3668ef;CloseWarningPopup();let _0x132d31=document[_0xd40a8a(0xfb)]('centre\x20bold')[0x0][_0xd40a8a(0xf2)];console[_0xd40a8a(0xfd)](_0xd40a8a(0xe6)+isMoreThanTwoMonthsFromToday(_0x132d31));if(isMoreThanTwoMonthsFromToday(_0x132d31)){await VratiSeUnazad();return;}const _0x3abb48=document[_0xd40a8a(0xf1)](_0xd40a8a(0xdf));let _0x462ad1=_0x3abb48[_0xd40a8a(0xf8)](_0xd40a8a(0xde))[_0xd40a8a(0x103)]('tr'),_0x6fb3b7=0x0,_0x3d9191=null;_0x462ad1[_0xd40a8a(0x10a)](_0x2a0941=>{const _0x277850=_0xd40a8a,_0x50b8d5=_0x2a0941[_0x277850(0x103)]('td');for(let _0xaccbc4=0x1;_0xaccbc4<_0x50b8d5[_0x277850(0xfe)]-0x1;_0xaccbc4++){const _0x18cf2d=_0x50b8d5[_0xaccbc4][_0x277850(0xf8)]('a'),_0x4afc49=_0x18cf2d['textContent'][_0x277850(0xfa)](),_0x17ec19=_0x4afc49[_0x277850(0xe5)](/\d+/);if(_0x17ec19){const _0x176ede=parseInt(_0x17ec19[0x0],0xa);_0x176ede>_0x6fb3b7&&!_0x4afc49[_0x277850(0x107)](_0x277850(0xe7))&&(_0x6fb3b7=_0x176ede,_0x3d9191=_0x18cf2d);}}}),_0x3d9191&&(_0x3d9191[_0xd40a8a(0x104)](),console[_0xd40a8a(0xfd)]('Clicked\x20anchor\x20with\x20max\x20number\x20'+_0x6fb3b7)),await NextWeek();}function CloseWarningPopup(){const _0x370ca1=_0x3668ef,_0x4ed7e5=document[_0x370ca1(0xf1)](_0x370ca1(0xef));_0x4ed7e5&&(_0x4ed7e5['click'](),console[_0x370ca1(0xfd)](_0x370ca1(0xf7)));}async function VratiSeUnazad(){const _0x17775e=_0x3668ef;await delay(time_for_going_back_in_seconds*0x3e8),CloseWarningPopup();const _0x41db07=document['getElementById'](_0x17775e(0xe8));if(_0x41db07)_0x41db07[_0x17775e(0x104)](),await VratiSeUnazad();else await FindAvailableSpots();}async function NextWeek(){const _0xb17965=_0x3668ef;await delay(timeBetweenSearchesInMiliSeconds);let _0x1efb88=document[_0xb17965(0xf1)]('searchForWeeklySlotsNextAvailable');if(_0x1efb88)_0x1efb88[_0xb17965(0x104)]();await delay(0x3e8),await FindAvailableSpots();}function isMoreThanTwoMonthsFromToday(_0x73b9f5){const _0x34a22e=_0x3668ef;let _0x17fb9a=_0x73b9f5[_0x34a22e(0xec)]('â€“')[0x0][_0x34a22e(0xfa)](),_0x44513c=_0x17fb9a[_0x34a22e(0xec)]('\x20')[0x0][_0x34a22e(0xff)](/\D/g,''),_0x5eb2ad=_0x17fb9a[_0x34a22e(0xec)]('\x20')[0x1],_0x2d7558=_0x17fb9a[_0x34a22e(0xec)]('\x20')[0x2],_0x567efa=new Date(),_0xe6d40b=[_0x34a22e(0x102),_0x34a22e(0xed),'March',_0x34a22e(0xf4),'May','June',_0x34a22e(0xee),_0x34a22e(0xe2),'September',_0x34a22e(0x108),_0x34a22e(0xf9),_0x34a22e(0xe0)],_0x5e2258=_0xe6d40b[_0x34a22e(0x100)](_0x5eb2ad),_0x198d09=new Date(_0x2d7558,_0x5e2258,_0x44513c),_0xebd8a2=(_0x198d09[_0x34a22e(0x101)]()-_0x567efa[_0x34a22e(0x101)]())*0xc+_0x198d09['getMonth']()-_0x567efa[_0x34a22e(0xf6)]();return _0xebd8a2>0x2||_0xebd8a2===0x2&&_0x567efa['getDate']()<_0x198d09[_0x34a22e(0xeb)]();}}
})();